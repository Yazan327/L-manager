{% extends "base.html" %}

{% block title %}Settings - PropertyFinder{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="bi bi-gear me-2"></i>Settings</h1>
</div>

<div class="row g-4">
    <div class="col-md-8">
        <!-- API Configuration -->
        <div class="card p-4 mb-4">
            <h5 class="mb-4"><i class="bi bi-plug me-2"></i>API Configuration</h5>
            
            <table class="table">
                <tr>
                    <td class="text-muted" style="width: 200px;">API Base URL</td>
                    <td><code>{{ config.api_base_url }}</code></td>
                </tr>
                <tr>
                    <td class="text-muted">API Token</td>
                    <td>
                        {% if config.has_token %}
                        <span class="text-success">
                            <i class="bi bi-check-circle me-1"></i> Configured
                        </span>
                        {% else %}
                        <span class="text-danger">
                            <i class="bi bi-x-circle me-1"></i> Not configured
                        </span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="text-muted">Agency ID</td>
                    <td>
                        {% if config.agency_id %}
                        <code>{{ config.agency_id }}</code>
                        {% else %}
                        <span class="text-muted">Not set</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="text-muted">Debug Mode</td>
                    <td>
                        {% if config.debug %}
                        <span class="badge bg-warning">Enabled</span>
                        {% else %}
                        <span class="badge bg-secondary">Disabled</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
            
            <div class="alert alert-info mt-3">
                <i class="bi bi-info-circle me-2"></i>
                To update API settings, edit the <code>.env</code> file in the project root and restart the server.
            </div>
        </div>
        
        <!-- Bulk Operation Settings -->
        <div class="card p-4">
            <h5 class="mb-4"><i class="bi bi-stack me-2"></i>Bulk Operation Settings</h5>
            
            <table class="table">
                <tr>
                    <td class="text-muted" style="width: 200px;">Batch Size</td>
                    <td>{{ config.bulk_batch_size }} listings per batch</td>
                </tr>
                <tr>
                    <td class="text-muted">Delay Between Requests</td>
                    <td>{{ config.bulk_delay }} seconds</td>
                </tr>
            </table>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Quick Help -->
        <div class="card p-4 mb-4">
            <h5><i class="bi bi-question-circle me-2"></i>Need Help?</h5>
            
            <ul class="list-unstyled mt-3">
                <li class="mb-2">
                    <a href="https://app.propertyfinder.ae/api-docs" target="_blank" class="text-decoration-none">
                        <i class="bi bi-book me-2"></i> API Documentation
                    </a>
                </li>
                <li class="mb-2">
                    <a href="#" class="text-decoration-none">
                        <i class="bi bi-file-text me-2"></i> User Guide
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Environment File -->
        <div class="card p-4">
            <h5><i class="bi bi-file-code me-2"></i>.env File Location</h5>
            
            <p class="text-muted small mt-3">
                The configuration file is located at:
            </p>
            <code class="d-block bg-light p-2 rounded small">
                /path/to/project/.env
            </code>
            
            <h6 class="mt-4">Required Variables</h6>
            <ul class="small mb-0">
                <li><code>PF_API_TOKEN</code></li>
                <li><code>PF_API_BASE_URL</code></li>
            </ul>
        </div>
    </div>
</div>

<!-- Test Connection -->
<div class="card p-4 mt-4">
    <h5><i class="bi bi-wifi me-2"></i>Test API Connection</h5>
    
    <p class="text-muted">Click the button below to test your API connection.</p>
    
    <button class="btn btn-outline-pf" id="test-connection-btn">
        <i class="bi bi-arrow-repeat me-1"></i> Test Connection
    </button>
    
    <div id="connection-result" class="mt-3"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('test-connection-btn').addEventListener('click', function() {
    const btn = this;
    const result = document.getElementById('connection-result');
    
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Testing...';
    result.innerHTML = '';
    
    fetch('/api/account')
        .then(response => {
            if (!response.ok) throw new Error('API request failed');
            return response.json();
        })
        .then(data => {
            result.innerHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-check-circle me-2"></i>
                    <strong>Connection successful!</strong>
                    <br><small>API is responding correctly.</small>
                </div>
            `;
        })
        .catch(error => {
            result.innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-x-circle me-2"></i>
                    <strong>Connection failed</strong>
                    <br><small>${error.message}</small>
                    <br><small class="text-muted">Check your API token and try again.</small>
                </div>
            `;
        })
        .finally(() => {
            btn.disabled = false;
            btn.innerHTML = '<i class="bi bi-arrow-repeat me-1"></i> Test Connection';
        });
});
</script>
{% endblock %}
