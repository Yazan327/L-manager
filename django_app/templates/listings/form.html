{% extends "workspaces/base.html" %}

{% block page_title %}{% if listing %}Edit Listing{% else %}Create Listing{% endif %}{% endblock %}

{% block content %}
<div class="mb-6">
    <nav class="flex" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-4">
            <li>
                <a href="{% url 'workspaces:listings:list' workspace_slug=workspace.slug %}" class="text-gray-400 hover:text-gray-500">
                    Listings
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <svg class="flex-shrink-0 h-5 w-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M5.555 17.776l8-16 .894.448-8 16-.894-.448z" />
                    </svg>
                    <span class="ml-4 text-sm font-medium text-gray-500">{% if listing %}Edit{% else %}Create{% endif %}</span>
                </div>
            </li>
        </ol>
    </nav>
</div>

<div class="max-w-4xl">
    <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h1 class="text-xl font-semibold text-gray-900">{% if listing %}Edit Listing{% else %}Create New Listing{% endif %}</h1>
        </div>
        
        <form method="POST" enctype="multipart/form-data" class="px-4 py-5 sm:px-6 space-y-8">
            {% csrf_token %}
            
            {% if messages %}
            <div class="rounded-md bg-red-50 p-4">
                {% for message in messages %}
                <p class="text-sm text-red-700">{{ message }}</p>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Basic Information -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h2>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div class="sm:col-span-2">
                        <label for="title" class="block text-sm font-medium text-gray-700">Title *</label>
                        <input type="text" name="title" id="title" required
                               value="{{ listing.title|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., Stunning 2BR Apartment in Dubai Marina">
                    </div>
                    
                    <div>
                        <label for="listing_type" class="block text-sm font-medium text-gray-700">Listing Type *</label>
                        <select name="listing_type" id="listing_type" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="sale" {% if listing.listing_type == 'sale' %}selected{% endif %}>For Sale</option>
                            <option value="rent" {% if listing.listing_type == 'rent' %}selected{% endif %}>For Rent</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="property_type" class="block text-sm font-medium text-gray-700">Property Type *</label>
                        <select name="property_type" id="property_type" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="">Select type...</option>
                            <option value="apartment" {% if listing.property_type == 'apartment' %}selected{% endif %}>Apartment</option>
                            <option value="villa" {% if listing.property_type == 'villa' %}selected{% endif %}>Villa</option>
                            <option value="townhouse" {% if listing.property_type == 'townhouse' %}selected{% endif %}>Townhouse</option>
                            <option value="penthouse" {% if listing.property_type == 'penthouse' %}selected{% endif %}>Penthouse</option>
                            <option value="studio" {% if listing.property_type == 'studio' %}selected{% endif %}>Studio</option>
                            <option value="office" {% if listing.property_type == 'office' %}selected{% endif %}>Office</option>
                            <option value="retail" {% if listing.property_type == 'retail' %}selected{% endif %}>Retail</option>
                            <option value="warehouse" {% if listing.property_type == 'warehouse' %}selected{% endif %}>Warehouse</option>
                            <option value="land" {% if listing.property_type == 'land' %}selected{% endif %}>Land</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="reference_number" class="block text-sm font-medium text-gray-700">Reference Number</label>
                        <input type="text" name="reference_number" id="reference_number"
                               value="{{ listing.reference_number|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., PROP-001">
                    </div>
                    
                    <div>
                        <label for="permit_number" class="block text-sm font-medium text-gray-700">Permit Number (DLD/ADREC)</label>
                        <input type="text" name="permit_number" id="permit_number"
                               value="{{ listing.permit_number|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., 1234567890">
                    </div>
                </div>
            </div>
            
            <!-- Location -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Location</h2>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div class="sm:col-span-2">
                        <label for="location" class="block text-sm font-medium text-gray-700">Location/Community *</label>
                        <input type="text" name="location" id="location" required
                               value="{{ listing.location|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., Dubai Marina, Dubai">
                    </div>
                    
                    <div>
                        <label for="building" class="block text-sm font-medium text-gray-700">Building/Project</label>
                        <input type="text" name="building" id="building"
                               value="{{ listing.building|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., Marina Heights">
                    </div>
                    
                    <div>
                        <label for="unit_number" class="block text-sm font-medium text-gray-700">Unit Number</label>
                        <input type="text" name="unit_number" id="unit_number"
                               value="{{ listing.unit_number|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., 1501">
                    </div>
                </div>
            </div>
            
            <!-- Price -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Pricing</h2>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-3">
                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700">Price *</label>
                        <input type="number" name="price" id="price" required
                               value="{{ listing.price|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                               placeholder="e.g., 1500000">
                    </div>
                    
                    <div>
                        <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
                        <select name="currency" id="currency"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="AED" {% if listing.currency == 'AED' or not listing %}selected{% endif %}>AED</option>
                            <option value="USD" {% if listing.currency == 'USD' %}selected{% endif %}>USD</option>
                            <option value="EUR" {% if listing.currency == 'EUR' %}selected{% endif %}>EUR</option>
                        </select>
                    </div>
                    
                    <div id="rental_period_wrapper" style="{% if listing.listing_type != 'rent' %}display: none;{% endif %}">
                        <label for="rental_period" class="block text-sm font-medium text-gray-700">Rental Period</label>
                        <select name="rental_period" id="rental_period"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="year" {% if listing.rental_period == 'year' %}selected{% endif %}>Yearly</option>
                            <option value="month" {% if listing.rental_period == 'month' %}selected{% endif %}>Monthly</option>
                            <option value="week" {% if listing.rental_period == 'week' %}selected{% endif %}>Weekly</option>
                            <option value="day" {% if listing.rental_period == 'day' %}selected{% endif %}>Daily</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Property Details -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Property Details</h2>
                <div class="grid grid-cols-1 gap-6 sm:grid-cols-4">
                    <div>
                        <label for="bedrooms" class="block text-sm font-medium text-gray-700">Bedrooms</label>
                        <input type="number" name="bedrooms" id="bedrooms" min="0"
                               value="{{ listing.bedrooms|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label for="bathrooms" class="block text-sm font-medium text-gray-700">Bathrooms</label>
                        <input type="number" name="bathrooms" id="bathrooms" min="0"
                               value="{{ listing.bathrooms|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label for="size" class="block text-sm font-medium text-gray-700">Size (sqft)</label>
                        <input type="number" name="size" id="size" min="0"
                               value="{{ listing.size|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    </div>
                    
                    <div>
                        <label for="parking" class="block text-sm font-medium text-gray-700">Parking</label>
                        <input type="number" name="parking" id="parking" min="0"
                               value="{{ listing.parking|default:'' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                    </div>
                </div>
            </div>
            
            <!-- Description -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Description</h2>
                <div>
                    <label for="description" class="sr-only">Description</label>
                    <textarea name="description" id="description" rows="6"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                              placeholder="Provide a detailed description of the property...">{{ listing.description|default:'' }}</textarea>
                </div>
            </div>
            
            <!-- Cover Image -->
            <div>
                <h2 class="text-lg font-medium text-gray-900 mb-4">Cover Image</h2>
                <div class="flex items-center space-x-6">
                    {% if listing.cover_image %}
                    <img src="{{ listing.cover_image.url }}" alt="Current cover" class="h-24 w-24 object-cover rounded-lg">
                    {% endif %}
                    <div class="flex-1">
                        <input type="file" name="cover_image" id="cover_image" accept="image/*"
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <p class="mt-1 text-xs text-gray-500">PNG, JPG up to 10MB</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4 border-t">
                <a href="{% url 'workspaces:listings:list' workspace_slug=workspace.slug %}"
                   class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    Cancel
                </a>
                <button type="submit" name="action" value="draft"
                        class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    Save as Draft
                </button>
                <button type="submit" name="action" value="publish"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">
                    {% if listing %}Update & Publish{% else %}Create & Publish{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Toggle rental period visibility based on listing type
document.getElementById('listing_type').addEventListener('change', function() {
    const rentalPeriodWrapper = document.getElementById('rental_period_wrapper');
    rentalPeriodWrapper.style.display = this.value === 'rent' ? '' : 'none';
});
</script>
{% endblock %}
